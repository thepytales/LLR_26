<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ELMeKS.digital Raumplaner</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    <style>
      :root { 
        --bg-dark: #1e1e1e;
        --bg-panel: #252526;
        --border: #3e3e42;
        --primary: #007acc; 
        --primary-hover: #0062a3;
        --text: #cccccc;
        --text-light: #ffffff;
        --danger: #d73a49;
        --btn-bg: #333333;
        --btn-hover: #444444;
      }
      
      body { 
        margin: 0; overflow: hidden; 
        font-family: 'Inter', "Segoe UI", sans-serif; 
        color: var(--text); background: var(--bg-dark); 
        user-select: none;
        font-size: 14px;
      }
      
      canvas { display: block; width: 100vw; height: 100vh; outline: none; }
      
      #ui-layer { 
        position: absolute; inset: 0; pointer-events: none; 
        display: flex; flex-direction: column; justify-content: space-between;
      }
      
      /* Top Bar */
      .top-bar {
        background: var(--bg-panel); 
        height: 50px;
        display: flex; align-items: center; padding: 0 20px;
        border-bottom: 1px solid var(--border);
        pointer-events: auto;
        box-shadow: 0 2px 10px rgba(0,0,0,0.2);
      }
      
      .brand { font-weight: 600; color: var(--text-light); margin-right: 20px; letter-spacing: 0.5px; }
      .separator { width: 1px; height: 20px; background: var(--border); margin: 0 15px; }
      .label-small { font-size: 11px; color: #888; margin-right: 8px; text-transform: uppercase; font-weight: 600; }

      select, button {
        background: var(--btn-bg); color: var(--text-light); border: 1px solid var(--border);
        padding: 6px 12px; border-radius: 4px; cursor: pointer; font-family: inherit; font-size: 13px;
        transition: all 0.2s; outline: none;
      }
      select:hover, button:hover { background: var(--btn-hover); border-color: #555; }
      button:active { transform: translateY(1px); }
      
      button.primary { background: var(--primary); border-color: var(--primary); color: white; }
      button.primary:hover { background: var(--primary-hover); }
      
      button.danger { color: var(--danger); border-color: var(--danger); background: transparent; }
      button.danger:hover { background: var(--danger); color: white; }
      
      /* Preset Buttons */
      .preset-grid { display: flex; flex-direction: column; gap: 6px; }
      button.preset-btn { 
        width: 100%; text-align: left; 
        background: #2d2d2d; border: 1px solid #3e3e42;
        padding: 10px; font-weight: 500;
        display: flex; justify-content: space-between; align-items: center;
      }
      button.preset-btn:hover { background: #383838; border-color: #555; transform: translateX(2px); }
      button.preset-btn::after { content: '›'; color: #666; font-weight: bold; }

      .stats { margin-left: auto; font-weight: 500; color: var(--text-light); display: flex; align-items: center; gap: 10px; }
      .badge { background: var(--primary); padding: 2px 8px; border-radius: 10px; font-size: 12px; }

      /* Sidebar */
      .sidebar {
        position: absolute; top: 70px; left: 20px; bottom: 80px; width: 280px;
        display: flex; flex-direction: column; gap: 15px; pointer-events: none;
        overflow-y: auto; padding-right: 5px;
      }
      .sidebar::-webkit-scrollbar { width: 4px; }
      .sidebar::-webkit-scrollbar-thumb { background: #444; border-radius: 2px; }

      .panel {
        background: var(--bg-panel); border: 1px solid var(--border);
        border-radius: 6px; padding: 15px; pointer-events: auto;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
      }
      .panel-header {
        font-size: 11px; text-transform: uppercase; letter-spacing: 1px; color: #888; margin-bottom: 10px; font-weight: 600;
      }

      .input-group { margin-bottom: 10px; }
      .input-group label { display: block; font-size: 12px; margin-bottom: 4px; color: #aaa; }
      .input-group input, .input-group select { width: 100%; box-sizing: border-box; }

      /* Bottom Bar */
      .bottom-bar {
        position: absolute; bottom: 20px; left: 320px; right: 20px;
        background: var(--bg-panel); border: 1px solid var(--border);
        border-radius: 6px; padding: 10px 20px;
        display: flex; align-items: center; gap: 20px;
        pointer-events: auto;
        box-shadow: 0 4px 20px rgba(0,0,0,0.3);
        flex-wrap: wrap;
      }
      .tool-section { display: flex; gap: 8px; align-items: center; }
      .tool-label { font-size: 11px; color: #666; font-weight: 600; margin-right: 8px; text-transform: uppercase; }

      /* Context Menu */
      #context-menu {
        position: absolute; bottom: 100px; left: 50%; transform: translateX(-50%);
        background: var(--bg-panel); padding: 8px 16px; border-radius: 30px;
        display: flex; gap: 10px; align-items: center;
        border: 1px solid var(--primary);
        box-shadow: 0 10px 40px rgba(0,0,0,0.5);
        opacity: 0; pointer-events: none; transition: opacity 0.2s, transform 0.2s;
        transform: translateX(-50%) translateY(10px);
      }
      #context-menu.visible { opacity: 1; pointer-events: auto; transform: translateX(-50%) translateY(0); }

      #notification {
        position: absolute; top: 70px; left: 50%; transform: translateX(-50%);
        background: var(--danger); color: white; padding: 10px 20px; border-radius: 4px;
        font-weight: 500; opacity: 0; pointer-events: none; transition: opacity 0.3s;
        z-index: 2000; box-shadow: 0 5px 15px rgba(0,0,0,0.5);
      }
      #notification.visible { opacity: 1; }

      #loader {
        position: absolute; inset: 0; background: rgba(0,0,0,0.8); z-index: 9999;
        display: flex; flex-direction: column; align-items: center; justify-content: center;
        transition: opacity 0.3s;
        opacity: 0; pointer-events: none; /* Hidden by default */
      }
      #loader.active { opacity: 1; pointer-events: auto; }
      
      .spinner {
        width: 30px; height: 30px; border: 3px solid #333; border-top: 3px solid var(--primary);
        border-radius: 50%; animation: spin 0.8s linear infinite; margin-bottom: 15px;
      }
      @keyframes spin { 100% { transform: rotate(360deg); } }
    </style>
  </head>
  <body>
    
    <div id="loader">
      <div class="spinner"></div>
      <div id="loading-text" style="color:#ddd; font-size: 14px; font-weight:500;">Lade...</div>
    </div>
    
    <div id="notification"></div>

    <div id="ui-layer">
      <!-- Top Navigation -->
      <div class="top-bar">
        <div class="brand">ELMeKS.digital Raumplaner</div>
        
        <select id="room-select">
          <option value="raummodell_leer.glb" selected>LLR (50m²)</option>
          <option value="LLR_möbliert(50qm).obj">LLR möbliert (50m²)</option>
          <option value="leer_70qm.glb">Großer Raum (70m²)</option>
          <option value="leer_30qm.glb">Kleiner Raum (30m²)</option>
        </select>
        
        <div class="separator"></div>
        
        <span class="label-small">Kameraposition:</span>
        <button onclick="app.setCamera('standard')">Standard</button>
        <button onclick="app.setCamera('top')">Grundriss</button>
        <button onclick="app.setCamera('corner')">Isometrisch</button>
        <div class="separator"></div>
        <button onclick="app.takeScreenshot()">Export Bild</button>

        <div class="stats">
          <span>Plätze:</span>
          <span class="badge" id="seat-count">0</span>
        </div>
      </div>

      <!-- Left Sidebar -->
      <div class="sidebar">
        
        <!-- Panel 1: Assistent -->
        <div class="panel">
          <div class="panel-header">Planungs-Assistent</div>
          
          <div class="input-group">
            <label>Szenario</label>
            <select id="wizard-scenario">
              <option value="lecture">Plenum (Reihen)</option>
              <option value="group">Gruppenarbeit (6er)</option>
              <option value="circle">Stuhlkreis</option>
              <option value="exam">Klausur (Einzeln)</option>
            </select>
          </div>

          <div class="input-group">
            <label>Personenanzahl (Ziel)</label>
            <input type="number" id="wizard-count" value="20" min="1" max="60" style="background:#333; color:white; border:1px solid #444; padding:6px; border-radius:4px;">
          </div>

          <button class="primary full-width" style="width:100%" onclick="app.runWizard()">Vorschlag generieren</button>
        </div>

        <!-- Panel 2: Manuelle Konstellationen -->
        <div class="panel">
          <div class="panel-header">Manuelle Konstellationen</div>
          <div class="preset-grid">
            <button class="preset-btn" onclick="app.addFurniture('k1')">2er Ecktisch</button>
            <button class="preset-btn" onclick="app.addFurniture('k2')">2er Vis-a-Vis</button>
            <button class="preset-btn" onclick="app.addFurniture('k5')">4er Ecktisch</button>
            <button class="preset-btn" onclick="app.addFurniture('k6')">6er Gruppentisch</button>
            <button class="preset-btn" onclick="app.addFurniture('k4')">8er Kreis (offen)</button>
            <button class="preset-btn" onclick="app.addFurniture('k3')">8er Gruppentisch</button>
            <button class="preset-btn" onclick="app.addFurniture('k8')">9er U-Form (Spitz)</button>
            <button class="preset-btn" onclick="app.addFurniture('k7')">11er U-Form</button>
          </div>
        </div>

        <!-- Panel 3: Aktionen -->
        <div class="panel">
          <div class="panel-header">Aktionen</div>
          <button class="danger full-width" style="width:100%" onclick="app.clearRoom()">Raum leeren</button>
        </div>
      </div>

      <!-- Context Menu -->
      <div id="context-menu">
        <button onclick="app.rotateSelection(1)">Drehen L</button>
        <button onclick="app.rotateSelection(-1)">Drehen R</button>
        <div class="separator"></div>
        <button class="danger" onclick="app.deleteSelection()">Entfernen</button>
      </div>

      <!-- Bottom Bar -->
      <div class="bottom-bar">
        <div class="tool-section">
          <div class="tool-label">Möbel</div>
          <button onclick="app.addFurniture('row_combo')">Tisch+Stuhl</button>
          <button onclick="app.addFurniture('tano')">Tano-Tisch</button>
          <button onclick="app.addFurniture('triangle')">Dreieck</button>
          <button onclick="app.addFurniture('chair')">Stuhl</button>
        </div>
        <div class="separator"></div>
        <div class="tool-section">
          <div class="tool-label">Ausstattung</div>
          <button onclick="app.addFurniture('board')">Tafel</button>
          <button onclick="app.addFurniture('teacher')">Pult</button>
          <button onclick="app.addFurniture('cupboard')">Regal</button>
        </div>
      </div>
    </div>

    <script type="module" src="script.js"></script>
  </body>
</html>